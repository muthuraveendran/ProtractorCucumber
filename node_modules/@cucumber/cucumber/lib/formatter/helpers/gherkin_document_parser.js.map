{"version":3,"file":"gherkin_document_parser.js","sourceRoot":"","sources":["../../../src/formatter/helpers/gherkin_document_parser.ts"],"names":[],"mappings":"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","sourcesContent":["import _, { Dictionary } from 'lodash'\nimport { messages } from '@cucumber/messages'\nimport { doesHaveValue } from '../../value_checker'\n\nexport function getGherkinStepMap(\n  gherkinDocument: messages.IGherkinDocument\n): Dictionary<messages.GherkinDocument.Feature.IStep> {\n  return _.chain(gherkinDocument.feature.children)\n    .map(extractStepContainers)\n    .flatten()\n    .map('steps')\n    .flatten()\n    .map((step: messages.GherkinDocument.Feature.IStep) => [step.id, step])\n    .fromPairs()\n    .value()\n}\n\nfunction extractStepContainers(\n  child: messages.GherkinDocument.Feature.IFeatureChild\n): Array<\n  | messages.GherkinDocument.Feature.IScenario\n  | messages.GherkinDocument.Feature.IBackground\n> {\n  if (doesHaveValue(child.background)) {\n    return [child.background]\n  } else if (doesHaveValue(child.rule)) {\n    return child.rule.children.map((ruleChild) =>\n      doesHaveValue(ruleChild.background)\n        ? ruleChild.background\n        : ruleChild.scenario\n    )\n  }\n  return [child.scenario]\n}\n\nexport function getGherkinScenarioMap(\n  gherkinDocument: messages.IGherkinDocument\n): Dictionary<messages.GherkinDocument.Feature.IScenario> {\n  return _.chain(gherkinDocument.feature.children)\n    .map((child: messages.GherkinDocument.Feature.IFeatureChild) => {\n      if (doesHaveValue(child.rule)) {\n        return child.rule.children\n      }\n      return [child]\n    })\n    .flatten()\n    .filter('scenario')\n    .map('scenario')\n    .map((scenario: messages.GherkinDocument.Feature.IScenario) => [\n      scenario.id,\n      scenario,\n    ])\n    .fromPairs()\n    .value()\n}\n\nexport function getGherkinExampleRuleMap(\n  gherkinDocument: messages.IGherkinDocument\n): Dictionary<messages.GherkinDocument.Feature.FeatureChild.IRule> {\n  return _.chain(gherkinDocument.feature.children)\n    .filter('rule')\n    .map('rule')\n    .map((rule) => {\n      return rule.children\n        .filter((child) => doesHaveValue(child.scenario))\n        .map((child) => [child.scenario.id, rule])\n    })\n    .flatten()\n    .fromPairs()\n    .value()\n}\n\nexport function getGherkinScenarioLocationMap(\n  gherkinDocument: messages.IGherkinDocument\n): Dictionary<messages.ILocation> {\n  const locationMap: Dictionary<messages.ILocation> = {}\n  const scenarioMap: Dictionary<messages.GherkinDocument.Feature.IScenario> = getGherkinScenarioMap(\n    gherkinDocument\n  )\n  _.entries<messages.GherkinDocument.Feature.IScenario>(scenarioMap).forEach(\n    ([id, scenario]) => {\n      locationMap[id] = scenario.location\n      if (doesHaveValue(scenario.examples)) {\n        _.chain(scenario.examples)\n          .map('tableBody')\n          .flatten()\n          .forEach((tableRow) => {\n            locationMap[tableRow.id] = tableRow.location\n          })\n          .value()\n      }\n    }\n  )\n  return locationMap\n}\n"]}