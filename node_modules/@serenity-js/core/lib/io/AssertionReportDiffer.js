"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AssertionReportDiffer = void 0;
const diff_1 = require("diff");
class AssertionReportDiffer {
    constructor(mappers) {
        this.mappers = mappers;
    }
    diff(expectedValue, actualValue) {
        const changes = diff_1.diffLines(actualValue, expectedValue)
            .map(change => this.markChanges(change));
        return [
            `Difference (${this.mappers.expected('expected')}, ${this.mappers.actual('actual')}):`,
            '',
            changes.length === 2
                ? changes.join('\n')
                : changes.join(''),
        ].join('\n');
    }
    markChanges(change) {
        return change.added
            ? this.eachLineOf(change.value, this.mappers.expected)
            : (change.removed
                ? this.eachLineOf(change.value, this.mappers.actual)
                : this.eachLineOf(change.value, this.mappers.matching));
    }
    eachLineOf(lines, mapper) {
        return lines.split('\n').map(line => line.trim()
            ? mapper(line)
            : line).join('\n');
    }
}
exports.AssertionReportDiffer = AssertionReportDiffer;
//# sourceMappingURL=AssertionReportDiffer.js.map