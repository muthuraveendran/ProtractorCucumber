"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.StreamReporter = void 0;
/**
 * @desc
 *  Serialises all the {@link DomainEvent} objects it receives and streams
 *  them as [ndjson](http://ndjson.org/) to the output stream.
 *
 * @example <caption>Writing DomainEvents to standard output</caption>
 *  import { configure, StreamReporter } from '@serenity-js/core';
 *
 *  configure({
 *      crew: [
 *          new StreamReporter(process.stdout)
 *      ],
 *  });
 *
 * @example <caption>Writing DomainEvents to a file</caption>
 *  import { configure, StreamReporter } from '@serenity-js/core';
 *  import fs = require('fs');
 *
 *  configure({
 *      crew: [
 *          new StreamReporter(fs.createWriteStream('./events.ndjson'))
 *      ],
 *  });
 *
 * @example <caption>Registering StreamReporter using Protractor configuration</caption>
 *  // protractor.conf.js
 *  const { StreamReporter } = require('@serenity-js/core');
 *
 *  exports.config = {
 *    framework:     'custom',
 *    frameworkPath: require.resolve('@serenity-js/protractor/adapter'),
 *
 *    serenity: {
 *      crew: [
 *        new StreamReporter(process.stdout),
 *      ],
 *      // other Serenity/JS config
 *    },
 *
 *    // other Protractor config
 *  };
 *
 * @implements {StageCrewMember}
 */
class StreamReporter {
    /**
     * @param {stream~Writable} output
     *  A Writable stream that should receive the output
     *
     * @param {Stage} [stage]
     *  The stage this {@link StageCrewMember} should be assigned to
     */
    constructor(output = process.stdout, stage) {
        this.output = output;
        this.stage = stage;
    }
    /**
     * @desc
     *  Creates a new instance of this {@link StageCrewMember} and assigns it to a given {@link Stage}.
     *
     * @see {@link StageCrewMember}
     *
     * @param {Stage} stage - An instance of a {@link Stage} this {@link StageCrewMember} will be assigned to
     * @returns {StageCrewMember} - A new instance of this {@link StageCrewMember}
     */
    assignedTo(stage) {
        return new StreamReporter(this.output, stage);
    }
    /**
     * @desc
     *  Handles {@link DomainEvent} objects emitted by the {@link StageManager}.
     *
     * @see {@link StageCrewMember}
     *
     * @listens {DomainEvent}
     *
     * @param {DomainEvent} event
     * @returns {void}
     */
    notifyOf(event) {
        this.output.write(JSON.stringify({ type: event.constructor.name, event: event.toJSON() }) + '\n');
    }
}
exports.StreamReporter = StreamReporter;
//# sourceMappingURL=StreamReporter.js.map